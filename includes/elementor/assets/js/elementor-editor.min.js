!function(t){"use strict";const e={},o={};function s(t,e){const o=e.$el.find('[data-setting="display_mode"]');if(!o.length)return;const s=o.find('option[value="playlist"]');t&&s.show()}function n(t,e){const o=t.split(":");if("transistor"!==o[0])return;const s=o[1],n=podloomElementor.sources||[];for(let t=0;t<n.length;t++)if("transistor"===n[t].type&&n[t].id===s){e.get("settings").set("show_slug",n[t].slug||"");break}}function i(s,n,i,c,p=1,u=!1){if(!s)return;const g=s.split(":"),m=g[0],f=g[1],_=s;if(1===p&&!u&&e[_])return void l(e[_],n,i,o[_]);!function(e){const o=d(e);o.length&&(o.empty().append(t("<option>",{value:"",text:podloomElementor.strings.loadingEpisodes})),o.prop("disabled",!0),a(o))}(n);const h={action:"transistor"===m?"podloom_get_episodes":"podloom_get_rss_episodes",nonce:podloomElementor.nonce,page:p,per_page:20};"transistor"===m?h.show_id=f:h.feed_id=f,t.ajax({url:podloomElementor.ajaxUrl,type:"POST",data:h,success:function(t){if(t.success){let s=[],d=!1,a=p;if("transistor"===m){s=t.data.data||[];const e=t.data.meta||{};d=e.currentPage<e.totalPages,a=e.currentPage||p}else{s=(t.data.episodes||[]).map(function(t){return{id:t.id,type:"rss_episode",attributes:{title:t.title,audio_url:t.audio_url,image:t.image,description:t.description,date:t.date,duration:t.duration,podcast20:t.podcast20||null}}}),d=t.data.page<t.data.pages,a=t.data.page||p}u&&e[_]?e[_]=e[_].concat(s):e[_]=s,o[_]={hasMore:d,currentPage:a,sourceType:m},l(e[_],n,i,o[_])}else r(n,t.data?.message||podloomElementor.strings.errorLoading)},error:function(){r(n,podloomElementor.strings.errorLoading)}})}function d(t){return t.$el.find('[data-setting="episode_id"]')}function a(t){t.length&&(t.hasClass("select2-hidden-accessible")&&t.select2("destroy"),t.select2({allowClear:!0,placeholder:podloomElementor.strings.selectEpisode,width:"100%",dropdownParent:t.closest(".elementor-control-content")}))}function r(e,o){const s=d(e);s.length&&(s.empty().append(t("<option>",{value:"",text:o})),s.prop("disabled",!1),a(s))}function l(e,o,s,n){const r=d(o);if(!r.length)return;const l=s.get("settings"),c=l.get("episode_id");r.empty(),r.append(t("<option>",{value:"",text:podloomElementor.strings.selectEpisode})),0===e.length?r.empty().append(t("<option>",{value:"",text:podloomElementor.strings.noEpisodes})):(e.forEach(function(e){const o=e.attributes.title||"Untitled",s=t("<option>",{value:e.id,text:o});e.id===c&&s.prop("selected",!0),r.append(s)}),n&&n.hasMore&&r.append(t("<option>",{value:"__load_more__",text:podloomElementor.strings.loadMore,css:{fontStyle:"italic",color:"#666"}}))),r.prop("disabled",!1),a(r),r.off("select2:select.podloom change.podloom"),r.on("select2:select.podloom",function(t){const d=t.params.data.id;if("__load_more__"===d){r.val(c||"").trigger("change.select2");return void i(l.get("source"),o,s,0,(n?.currentPage||1)+1,!0)}const a=e.find(function(t){return t.id===d});a?function(t,e){const o=e.get("settings"),s=o.get("source"),n=s.split(":")[0],i=o.get("theme")||"light";if(o.set("episode_id",t.id),"transistor"===n){const e="dark"===i&&t.attributes.embed_html_dark||t.attributes.embed_html;o.set("embed_html",e||""),o.set("episode_data","")}else{const e={id:t.id,title:t.attributes.title,audio_url:t.attributes.audio_url,image:t.attributes.image,description:t.attributes.description,date:t.attributes.date,duration:t.attributes.duration,podcast20:t.attributes.podcast20||null};o.set("episode_data",JSON.stringify(e)),o.set("embed_html","")}}(a,s):(l.set("episode_id",""),l.set("episode_data",""),l.set("embed_html",""))}),r.on("change.podloom",function(){t(this).val()||(l.set("episode_id",""),l.set("episode_data",""),l.set("embed_html",""))})}t(window).on("elementor:init",function(){elementor.hooks.addAction("panel/open_editor/widget/podloom-episode",function(t,o,d){!function(t,o,d){t.$el;setTimeout(function(){const a=o.get("settings"),r=a.get("source");!function(t,e,o){const d=e.get("settings");d.on("change:source",function(d,a){d.set("episode_id",""),d.set("episode_data",""),d.set("embed_html",""),a&&(a.startsWith("transistor:")?n(a,e):d.set("show_slug",""),s(a,t),"specific"===d.get("display_mode")&&i(a,t,e,o)),o.render()})}(t,o,d),function(t,e,o){const s=e.get("settings");s.on("change:display_mode",function(s,n){const d=s.get("source");"specific"===n&&d&&i(d,t,e,o),o.render()})}(t,o,d),function(t,o,s){const n=o.get("settings");n.on("change:theme",function(t,n){const i=t.get("source"),d=t.get("episode_id");i&&i.startsWith("transistor:")&&d&&function(t,o,s,n){const i=t,d=e[i];if(!d)return;const a=d.find(function(t){return t.id===o});if(a){const t="dark"===s&&a.attributes.embed_html_dark||a.attributes.embed_html;n.get("settings").set("embed_html",t||"")}}(i,d,n,o),s.render()})}(0,o,d),r&&"specific"===a.get("display_mode")&&i(r,t,o,d),r&&r.startsWith("transistor:")&&n(r,o),s(r,t)},100)}(t,o,d)})})}(jQuery);