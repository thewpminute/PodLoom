!function(){"use strict";var e=null;function t(t){var a=(e||((e=document.createElement("div")).setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="podloom-sr-announcer",e.style.cssText="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;",document.body.appendChild(e)),e);a.textContent="",setTimeout(function(){a.textContent=t},50)}function a(e,t){const a=e.querySelectorAll(".chapter-item");let o=null;a.forEach(function(e){const a=parseFloat(e.getAttribute("data-start-time"));!isNaN(a)&&t>=a&&(o=e)}),a.forEach(function(e){e.classList.remove("active"),e.removeAttribute("aria-current")}),o&&(o.classList.add("active"),o.setAttribute("aria-current","true"));const r=e.closest(".rss-episode-player");if(r){const e=r.querySelector(".rss-episode-artwork img");if(e){let t=null;if(o){const e=o.querySelector(".chapter-img");e&&(t=e.src)}if(t)e.src!==t&&(e.src=t);else{const t=e.getAttribute("data-original-src");t&&e.src!==t&&(e.src=t)}}}}function o(e,a,s,c){var p=c.closest(".transcript-viewer");if(a>=e.length){s.classList.remove("loading"),s.removeAttribute("aria-busy"),p&&p.removeAttribute("aria-busy");const t=(e[0].url||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");return void(c.innerHTML='<div class="transcript-error" role="alert">Could not load transcript. <a href="'+t+'" target="_blank" rel="noopener noreferrer">Open in new tab</a></div>')}const u=e[a],m=u.url,f=u.type||"text/plain",h="undefined"!=typeof podloomTranscript&&podloomTranscript.ajaxUrl?podloomTranscript.ajaxUrl+"?action=podloom_fetch_transcript&url="+encodeURIComponent(m):m;fetch(h).then(function(e){return e.json().then(function(t){if(!e.ok){const a=t.data&&t.data.message?t.data.message:"HTTP "+e.status;throw console.error("Transcript proxy error ("+e.status+"):",a,"URL:",m),new Error(a)}return t})}).then(function(e){if(!(e.success&&e.data&&e.data.content))throw new Error(e.data?e.data.message:"Failed to load transcript");{const a=function(e,t){var a=e.trim();if(a.startsWith("<!DOCTYPE")||a.startsWith("<html")||a.includes("<body")&&a.includes("</body>"))return n(e);if(t.includes("html"))return n(e);if(t.includes("srt"))return i(e);if(t.includes("vtt"))return function(e){return e=e.replace(/^WEBVTT\s*\n/,""),i(e)}(e);if(t.includes("json"))return function(e){try{var t=JSON.parse(e),a="";return t.segments&&Array.isArray(t.segments)&&t.segments.forEach(function(e){void 0!==e.startTime&&e.body&&(a+='<p><span class="transcript-timestamp" data-time="'+e.startTime+'">'+l(e.startTime)+"</span>"+d(e.body)+"</p>")}),a||"<p>No transcript content found.</p>"}catch(e){return'<p class="transcript-error">Invalid JSON format.</p>'}}(e);if(t.includes("text/plain")||t.includes("text/txt")||t.includes(".txt"))return r(e);return r(e)}(e.data.content,f);c.innerHTML=a,s.classList.remove("loading"),s.classList.add("active"),s.removeAttribute("aria-busy"),s.setAttribute("aria-expanded","true"),p&&p.removeAttribute("aria-busy"),function(e){var a=e.querySelectorAll(".transcript-timestamp"),o=e.closest(".podcast20-transcripts"),r=o?o.closest(".rss-episode-player"):null;if(!r)return;var n=r.querySelector("audio");if(!n)return;a.forEach(function(e){function a(){var a=parseFloat(e.getAttribute("data-time"));isNaN(a)||(n.currentTime=a,n.paused&&n.play().catch(function(e){console.warn("Could not auto-play audio:",e)}),t("Seeking to "+e.textContent))}e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.addEventListener("click",a),e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),a())})})}(c),t("Transcript loaded")}}).catch(function(t){console.warn("Transcript load failed for "+m+", trying next format...",t),o(e,a+1,s,c)})}function r(e){var t=e.trim().split(/\n\s*\n/),a="";return t.forEach(function(e){e.trim()&&(a+="<p>"+d(e.trim().replace(/\n/g,"<br>"))+"</p>")}),a||"<p>"+d(e)+"</p>"}function n(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),a=document.createElement("div"),o=[".transcript",".transcript-content",".episode-transcript","[data-transcript]","article","main",".content",".episode-content"],r=null,n=0;n<o.length&&!(r=t.querySelector(o[n]));n++);if(r)a.appendChild(r.cloneNode(!0));else{t.body&&Array.from(t.body.childNodes).forEach(function(e){a.appendChild(e.cloneNode(!0))});["header","nav","footer",".header",".navigation",".nav",".footer",".sidebar",".menu",".social",'[role="navigation"]','[role="banner"]','[role="complementary"]'].forEach(function(e){a.querySelectorAll(e).forEach(function(e){e.remove()})})}return["script","iframe","object","embed","link","style","form"].forEach(function(e){a.querySelectorAll(e).forEach(function(e){e.remove()})}),a.querySelectorAll("*").forEach(function(e){if(Array.from(e.attributes).forEach(function(t){(t.name.startsWith("on")||"style"===t.name)&&e.removeAttribute(t.name)}),e.hasAttribute("href")){var t=e.getAttribute("href");t&&(t.toLowerCase().startsWith("javascript:")||t.toLowerCase().startsWith("data:"))&&e.removeAttribute("href")}}),a.querySelectorAll("[data-time], [data-timestamp]").forEach(function(e){e.classList.contains("transcript-timestamp")||e.classList.add("transcript-timestamp"),e.hasAttribute("data-timestamp")&&!e.hasAttribute("data-time")&&e.setAttribute("data-time",e.getAttribute("data-timestamp"))}),function(e){var t,a=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);for(;t=o.nextNode();)t.textContent.trim()&&a.push(t);return a}(a).forEach(function(e){for(var t,a=e.textContent,o=/[\[\(]?(\d{1,2}):(\d{2})(?::(\d{2}))?[\]\)]?/g,r=[];null!==(t=o.exec(a));){var n;if(t[3])n=3600*parseInt(t[1],10)+60*parseInt(t[2],10)+parseInt(t[3],10);else n=60*parseInt(t[1],10)+parseInt(t[2],10);n<86400&&r.push({match:t[0],index:t.index,time:n})}if(r.length>0){var i=document.createDocumentFragment(),s=0;r.forEach(function(e){e.index>s&&i.appendChild(document.createTextNode(a.substring(s,e.index)));var t=document.createElement("span");t.className="transcript-timestamp",t.setAttribute("data-time",e.time),t.textContent=e.match,i.appendChild(t),s=e.index+e.match.length}),s<a.length&&i.appendChild(document.createTextNode(a.substring(s))),e.parentNode&&e.parentNode.replaceChild(i,e)}}),a.innerHTML}function i(e){var t=e.trim().split(/\n\s*\n/),a=[];if(t.forEach(function(e){var t=e.split("\n");if(!(t.length<3)){var o=t[1].split(" --\x3e ");if(!(o.length<2)){var r=s(o[0]),n=s(o[1]),i=t.slice(2).join(" ").trim();!isNaN(r)&&i&&a.push({startTime:r,endTime:n,text:i})}}}),0===a.length)return"<p>No transcript content found.</p>";var o=[],r=null;a.forEach(function(e,t){var n=t>0?a[t-1]:null,i=n?e.startTime-n.endTime:0;!r||i>=3?(r&&o.push(r),r={startTime:e.startTime,texts:[e.text]}):r.texts.push(e.text)}),r&&o.push(r);var n="";return o.forEach(function(e){var t=e.texts.join(" ");n+='<p><span class="transcript-timestamp" data-time="'+e.startTime+'">'+l(e.startTime)+"</span> "+d(t)+"</p>"}),n}function s(e){var t=e.split(":");return 3600*parseInt(t[0],10)+60*parseInt(t[1],10)+parseFloat(t[2].replace(",","."))}function l(e){var t=Math.floor(e/3600),a=Math.floor(e%3600/60),o=Math.floor(e%60);return t>0?t+":"+c(a)+":"+c(o):a+":"+c(o)}function c(e){return e<10?"0"+e:e}function d(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}function p(){document.querySelectorAll(".rss-playlist-player").forEach(function(e){if(!e.hasAttribute("data-playlist-initialized")){e.setAttribute("data-playlist-initialized","true");var a=e.querySelector(".podloom-playlist-data");if(a){var r;try{r=JSON.parse(a.textContent)}catch(e){return void console.error("PodLoom: Failed to parse playlist data",e)}if(r&&0!==r.length){var n=e.querySelector(".podloom-playlist-audio"),i=e.querySelector(".podloom-playlist-artwork"),s=e.querySelector(".podloom-playlist-title"),l=e.querySelector(".podloom-playlist-date"),c=e.querySelector(".podloom-playlist-duration"),d=e.querySelector(".podloom-episodes-list");if(n&&d){var p=0,u=e.getAttribute("data-feed-id")||"",m=parseInt(e.getAttribute("data-total-episodes")||r.length,10),f=function(e,t,a){var o=[],r=t.slice(),n=!1,i=r.length<a,s=r.length;function l(){if(n||!i)return Promise.resolve([]);if(o.length>=10)return Promise.resolve([]);n=!0;var t="undefined"!=typeof podloomPlaylist&&podloomPlaylist.ajaxUrl?podloomPlaylist.ajaxUrl:"undefined"!=typeof ajaxurl?ajaxurl:"/wp-admin/admin-ajax.php",a="undefined"!=typeof podloomPlaylist&&podloomPlaylist.nonce?podloomPlaylist.nonce:"";return fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action=podloom_get_rss_episodes_public&feed_id="+encodeURIComponent(e)+"&offset="+s+"&limit=20&nonce="+encodeURIComponent(a)}).then(function(e){return e.json()}).then(function(e){if(n=!1,e.success&&e.data&&e.data.episodes){var t=e.data.episodes;return o=o.concat(t),s+=t.length,i=e.data.has_more,t}return[]}).catch(function(){return n=!1,[]})}return i&&setTimeout(l,1e3),{getMore:function(e){if(e=e||10,o.length>=e){var t=o.splice(0,e);return r=r.concat(t),o.length<10&&i&&l(),Promise.resolve(t)}return l().then(function(){if(o.length>0){var t=o.splice(0,Math.min(e,o.length));return r=r.concat(t),t}return[]})},hasMore:function(){return i||o.length>0},getDisplayed:function(){return r},isLoading:function(){return n}}}(u,r,m);d.querySelectorAll(".podloom-episode-item").forEach(function(e,t){function a(){var t=parseInt(e.getAttribute("data-episode-index"),10);isNaN(t)||t===p?t===p&&n.paused&&n.play().catch(function(e){console.warn("PodLoom: Could not play",e)}):w(t)}e.style.cursor="pointer",e.setAttribute("role","button"),e.setAttribute("tabindex","0"),0===t&&e.setAttribute("aria-current","true"),e.addEventListener("click",a),e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),a())})}),n.addEventListener("ended",function(){var e=p+1;e<r.length&&w(e)}),n.addEventListener("timeupdate",function(){var t=e.querySelector(".podloom-playlist-chapters .podcast20-chapters-list");if(t){var a=t.querySelectorAll(".chapter-item"),o=n.currentTime,r=null;if(a.forEach(function(e){var t=parseFloat(e.getAttribute("data-start-time"));!isNaN(t)&&o>=t&&(r=e)}),a.forEach(function(e){e.classList.remove("active")}),r&&r.classList.add("active"),i){var s=null;if(r){var l=r.querySelector(".chapter-img");l&&(s=l.src)}if(s)i.src!==s&&(i.src=s);else{var c=i.getAttribute("data-original-src");c&&i.src!==c&&(i.src=c)}}}});var h=!1;d.addEventListener("scroll",function(){!h&&f.hasMore()&&(d.scrollHeight-d.scrollTop-d.clientHeight<200&&(h=!0,f.getMore(10).then(function(e){e.length>0&&function(e){e.forEach(function(e,t){var a=r.length;r.push(e);var o=document.createElement("div");o.className="podloom-episode-item",o.setAttribute("data-episode-index",a),o.setAttribute("role","button"),o.setAttribute("tabindex","0"),o.style.cursor="pointer";var i=document.createElement("div");i.className="podloom-episode-thumb",e.image?i.innerHTML='<img src="'+C(e.image)+'" alt="'+C(e.title||"")+'" loading="lazy">':i.classList.add("podloom-episode-thumb-placeholder");var s=document.createElement("div");s.className="podloom-episode-play-overlay",s.innerHTML='<span class="podloom-play-icon" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg></span>',i.appendChild(s);var l=document.createElement("div");l.className="podloom-episode-info";var c=document.createElement("div");c.className="podloom-episode-title-row",c.innerHTML='<div class="podloom-episode-item-title">'+C(e.title||"")+"</div>",l.appendChild(c);var u=document.createElement("div");u.className="podloom-episode-meta-row",e.date&&(u.innerHTML+='<span class="podloom-episode-item-date">'+g(e.date)+"</span>"),e.duration&&(u.innerHTML+='<span class="podloom-episode-item-duration">'+v(e.duration)+"</span>"),l.appendChild(u),o.appendChild(i),o.appendChild(l),d.appendChild(o),o.addEventListener("click",function(){a!==p?w(a):n.paused&&n.play().catch(function(){})}),o.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o.click())})})}(e),h=!1})))})}}}else console.warn("PodLoom: No playlist data found")}function v(e){if(!e||isNaN(e))return"";e=parseInt(e,10);var t=Math.floor(e/3600),a=Math.floor(e%3600/60),o=e%60;return t>0?t+":"+y(a)+":"+y(o):a+":"+y(o)}function y(e){return e<10?"0"+e:e}function g(e){return e?new Date(1e3*e).toLocaleDateString():""}function b(e){if(!e||0===e.length)return'<p class="no-content">No chapters available for this episode.</p>';var t='<div class="podcast20-chapters-list">';return t+='<h4 class="chapters-heading">Chapters</h4>',e.forEach(function(e){var a=e.startTime||0,o=v(a),r=C(e.title||"");t+='<div class="chapter-item" data-start-time="'+a+'">',e.img?t+='<img src="'+C(e.img)+'" alt="'+r+'" class="chapter-img" loading="lazy" />':t+='<div class="chapter-img-placeholder"></div>',t+='<div class="chapter-info">',t+='<button class="chapter-timestamp" data-start-time="'+a+'">'+o+"</button>",t+='<span class="chapter-title">'+r,e.url&&(t+=' <a href="'+C(e.url)+'" target="_blank" rel="noopener noreferrer" class="chapter-external-link" title="Open chapter link">',t+='<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor" style="display: inline-block; vertical-align: middle; margin-left: 4px;">',t+='<path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086 0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/>',t+='<path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02 0 01-.82 1H12a3 3 0 100-6H9z"/>',t+="</svg></a>"),t+="</span>",t+="</div>",t+="</div>"}),t+="</div>"}function L(e){if(!e||0===e.length)return'<p class="no-content">No credits available for this episode.</p>';var t='<div class="podcast20-people">';return t+='<h4 class="podcast20-heading">Credits</h4>',t+='<div class="podcast20-people-list">',e.forEach(function(e){if(e.name){var a=C(e.name),o=e.role?C(e.role):"";t+='<div class="podcast20-person">',e.img?t+='<img src="'+C(e.img)+'" alt="'+a+'" class="podcast20-person-img">':(t+='<div class="podcast20-person-avatar">',t+='<svg width="40" height="40" viewBox="0 0 16 16" fill="currentColor">',t+='<path d="M11 6a3 3 0 11-6 0 3 3 0 016 0z"/>',t+='<path d="M2 0a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V2a2 2 0 00-2-2H2zm12 1a1 1 0 011 1v12a1 1 0 01-1 1v-1c0-1-1-4-6-4s-6 3-6 4v1a1 1 0 01-1-1V2a1 1 0 011-1h12z"/>',t+="</svg></div>"),t+='<div class="podcast20-person-info">',o&&(t+='<span class="podcast20-person-role">'+o.charAt(0).toUpperCase()+o.slice(1)+"</span>"),e.href?t+='<a href="'+C(e.href)+'" target="_blank" rel="noopener noreferrer" class="podcast20-person-name">'+a+"</a>":t+='<span class="podcast20-person-name">'+a+"</span>",t+="</div>",t+="</div>"}}),t+="</div>",t+="</div>"}function A(e){if(!e||0===e.length)return'<p class="no-content">No transcript available for this episode.</p>';var t={"text/html":1,"application/x-subrip":2,"text/srt":2,"text/vtt":3,"application/json":4,"text/plain":5};e.sort(function(e,a){return(t[e.type]||999)-(t[a.type]||999)});var a=e[0],o=JSON.stringify(e),r='<div class="podcast20-transcripts">';return r+='<div class="transcript-formats">',r+='<button class="transcript-format-button" data-url="'+C(a.url)+'" data-type="'+C(a.type||"text/plain")+"\" data-transcripts='"+C(o).replace(/'/g,"&#39;")+"'>",r+='<svg class="podcast20-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">',r+='<path d="M14 4.5V14a2 2 0 01-2 2H4a2 2 0 01-2-2V2a2 2 0 012-2h5.5L14 4.5zm-3 0A1.5 1.5 0 019.5 3V1H4a1 1 0 00-1 1v12a1 1 0 001 1h8a1 1 0 001-1V4.5h-2z"/>',r+='<path d="M3 9.5h10v1H3v-1zm0 2h10v1H3v-1z"/>',r+="</svg>",r+="<span>Click for Transcript</span>",r+="</button>",r+=' <a href="'+C(a.url)+'" target="_blank" rel="noopener noreferrer" class="transcript-external-link" title="Open transcript in new tab">',r+='<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">',r+='<path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086 0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/>',r+='<path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02 0 01-.82 1H12a3 3 0 100-6H9z"/>',r+="</svg></a>",r+="</div>",r+='<div class="transcript-viewer" style="display: none;">',r+='<div class="transcript-content"></div>',r+='<button class="transcript-close">Close</button>',r+="</div>",r+="</div>"}function x(e,t){e.querySelectorAll(".chapter-item").forEach(function(e){e.style.cursor="pointer",e.addEventListener("click",function(a){if(!a.target.closest(".chapter-external-link")){a.preventDefault();var o=parseFloat(e.getAttribute("data-start-time"));isNaN(o)||(t.currentTime=o,t.paused&&t.play().catch(function(e){console.warn("PodLoom: Could not auto-play",e)}))}})})}function E(e){e.querySelectorAll(".transcript-format-button").forEach(function(e){e.addEventListener("click",function(){var t,a=e.closest(".podcast20-transcripts").querySelector(".transcript-viewer"),r=a.querySelector(".transcript-content");if(e.classList.contains("active"))return e.classList.remove("active"),a.style.display="none",void(r.innerHTML="");try{t=JSON.parse(e.getAttribute("data-transcripts"))}catch(e){t=[]}0!==t.length&&(e.classList.add("loading"),a.style.display="block",r.innerHTML='<div class="transcript-loading">Loading transcript...</div>',o(t,0,e,r))})}),e.querySelectorAll(".transcript-close").forEach(function(e){e.addEventListener("click",function(){var t=e.closest(".transcript-viewer"),a=e.closest(".podcast20-transcripts").querySelector(".transcript-format-button"),o=t.querySelector(".transcript-content");a.classList.remove("active"),t.style.display="none",o.innerHTML=""})})}function S(e,t,a){if("undefined"!=typeof podloomPlaylist&&podloomPlaylist.ajaxUrl){var o=new XMLHttpRequest;o.open("POST",podloomPlaylist.ajaxUrl,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)try{var e=JSON.parse(o.responseText);e.success&&e.data?a(e.data):a(null)}catch(e){a(null)}else a(null)},o.send("action=podloom_get_episode_p20&feed_id="+encodeURIComponent(e)+"&episode_id="+encodeURIComponent(t)+"&nonce="+encodeURIComponent(podloomPlaylist.nonce||""))}else a(null)}function w(a){if(!(a<0||a>=r.length)){var o=r[a];p=a;var m,f=n.querySelector("source");f?f.src=o.audio_url:n.src=o.audio_url,n.load(),n.play().catch(function(e){console.warn("PodLoom: Could not auto-play episode",e)}),function(e){s&&e.title&&(s.textContent=e.title),l&&e.date&&(l.textContent=g(e.date)),c&&e.duration&&(c.textContent=v(e.duration)),i&&e.image&&(i.src=e.image,i.alt=e.title||"",i.setAttribute("data-original-src",e.image))}(o),m=a,d.querySelectorAll(".podloom-episode-item").forEach(function(e,t){var a=e.querySelector(".podloom-episode-play-overlay");a&&(t===m?(e.classList.add("podloom-episode-current"),e.setAttribute("aria-current","true"),a.innerHTML='<span class="podloom-now-playing-icon" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="4" height="16" rx="1"><animate attributeName="height" values="16;8;16" dur="0.8s" repeatCount="indefinite"/><animate attributeName="y" values="4;8;4" dur="0.8s" repeatCount="indefinite"/></rect><rect x="10" y="4" width="4" height="16" rx="1"><animate attributeName="height" values="8;16;8" dur="0.8s" repeatCount="indefinite"/><animate attributeName="y" values="8;4;8" dur="0.8s" repeatCount="indefinite"/></rect><rect x="16" y="4" width="4" height="16" rx="1"><animate attributeName="height" values="16;8;16" dur="0.8s" repeatCount="indefinite" begin="0.2s"/><animate attributeName="y" values="4;8;4" dur="0.8s" repeatCount="indefinite" begin="0.2s"/></rect></svg></span>'):(e.classList.remove("podloom-episode-current"),e.removeAttribute("aria-current"),a.innerHTML='<span class="podloom-play-icon" aria-hidden="true"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg></span>'))}),function(t){var a=e.querySelector('[data-tab-id="description"]');if(a){var o=a.querySelector(".podloom-playlist-description");if(o){var r=t.content||t.description||"";o.innerHTML=r}}var i=t.podcast20,s=e.querySelector('[data-tab-id="chapters"]');if(s){var l=s.querySelector(".podloom-playlist-chapters");if(l){var c=i&&i.chapters&&i.chapters.chapters?i.chapters.chapters:null;c&&c.length>0?(l.innerHTML=b(c),x(l,n)):u&&t.id?S(u,t.id,function(e){var t=e&&e.chapters&&e.chapters.chapters?e.chapters.chapters:null;t&&t.length>0?(l.innerHTML=b(t),x(l,n)):l.innerHTML='<p class="no-content">No chapters available for this episode.</p>'}):l.innerHTML='<p class="no-content">No chapters available for this episode.</p>'}}var d=e.querySelector('[data-tab-id="credits"]');if(d){var p=d.querySelector(".podloom-playlist-credits");if(p)if(i&&(i.people_channel&&i.people_channel.length>0||i.people_episode&&i.people_episode.length>0)){var m=[];i.people_channel&&(m=m.concat(i.people_channel)),i.people_episode&&(m=m.concat(i.people_episode)),p.innerHTML=L(m)}else u&&t.id?S(u,t.id,function(e){if(e){var t=[];e.people_channel&&(t=t.concat(e.people_channel)),e.people_episode&&(t=t.concat(e.people_episode)),t.length>0?p.innerHTML=L(t):p.innerHTML='<p class="no-content">No credits available for this episode.</p>'}else p.innerHTML='<p class="no-content">No credits available for this episode.</p>'}):p.innerHTML='<p class="no-content">No credits available for this episode.</p>'}var f=e.querySelector('[data-tab-id="transcripts"]');if(f){var h=f.querySelector(".podloom-playlist-transcripts");h&&(i&&i.transcripts&&i.transcripts.length>0?(h.innerHTML=A(i.transcripts),E(h)):u&&t.id?S(u,t.id,function(e){e&&e.transcripts&&e.transcripts.length>0?(h.innerHTML=A(e.transcripts),E(h)):h.innerHTML='<p class="no-content">No transcript available for this episode.</p>'}):h.innerHTML='<p class="no-content">No transcript available for this episode.</p>')}}(o);var h=d.querySelector('[data-episode-index="'+a+'"]');h&&h.scrollIntoView({behavior:"smooth",block:"nearest"}),t("Now playing: "+(o.title||"Episode "+(a+1)))}}function C(e){if(!e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}})}function u(){document.querySelectorAll(".rss-playlist-player").forEach(function(e){if(!e.hasAttribute("data-search-pagination-initialized")){e.setAttribute("data-search-pagination-initialized","true");var a=e.getAttribute("data-feed-id"),o=parseInt(e.getAttribute("data-total"),10)||0,r=parseInt(e.getAttribute("data-loaded"),10)||0,n=parseInt(e.getAttribute("data-step"),10)||20,i=e.getAttribute("data-order")||"episodic",s=e.querySelector(".podloom-episodes-search-input"),l=e.querySelector(".podloom-episodes-search-clear"),c=e.querySelector(".podloom-search-status"),d=e.querySelector(".podloom-episodes-list"),p=e.querySelector(".podloom-episodes-load-more"),u=e.querySelector(".podloom-episodes-no-results"),m=null,f=null,h="",v=!1,y=e.querySelector(".podloom-playlist-data"),g=[];if(y)try{g=JSON.parse(y.textContent)}catch(e){console.error("PodLoom: Failed to parse playlist data")}s&&(s.addEventListener("input",function(){var e=s.value.trim();h=e,l&&(l.style.display=e?"":"none"),clearTimeout(m),clearTimeout(f),e?m=setTimeout(function(){var t=function(e){e=e.toLowerCase().trim();var t=d.querySelectorAll(".podloom-episode-item"),a=0;return t.forEach(function(t){var o=(t.getAttribute("data-search-term")||"").toLowerCase();e&&-1===o.indexOf(e)?t.classList.add("podloom-search-hidden"):(t.classList.remove("podloom-search-hidden"),a++)}),p&&(p.closest(".podloom-episodes-load-more-wrapper").style.display=e?"none":""),a}(e);c&&(o>r&&e.length>=2?c.textContent=t+" found (searching...)":c.textContent=t+" episode"+(1!==t?"s":"")+" found"),o>r&&e.length>=2?f=setTimeout(function(){h===e&&b(e)},400):u&&(u.style.display=0===t?"":"none",0===t&&(u.textContent='No episodes found for "'+e+'"'))},100):E()}),s.addEventListener("keydown",function(e){"Escape"===e.key&&(E(),s.blur())})),l&&l.addEventListener("click",function(){E(),s&&s.focus()}),p&&p.addEventListener("click",function(){if(p&&!p.hasAttribute("disabled")){p.setAttribute("disabled","true");var t=p.querySelector(".podloom-load-more-text"),s=p.querySelector(".podloom-load-more-loading");t&&(t.style.display="none"),s&&(s.style.display="");var l="undefined"!=typeof podloomPlaylist&&podloomPlaylist.ajaxUrl?podloomPlaylist.ajaxUrl:"/wp-admin/admin-ajax.php",c=new FormData;c.append("action","podloom_playlist_episodes"),c.append("feed_id",a),c.append("offset",r),c.append("limit",n),c.append("order",i),fetch(l,{method:"POST",body:c}).then(function(e){return e.json()}).then(function(a){if(p.removeAttribute("disabled"),t&&(t.style.display=""),s&&(s.style.display="none"),a.success&&a.data.episodes){var n=a.data.episodes;n.forEach(function(t,a){var o=L(t,r+a);d.appendChild(o),S(o,e,t),g.push(t)}),r+=n.length,e.setAttribute("data-loaded",r);var i=o-r;if(i<=0||!a.data.has_more){var l=p.closest(".podloom-episodes-load-more-wrapper");l&&(l.style.display="none")}else t&&(t.textContent="Load More ("+i+" remaining)")}}).catch(function(e){p.removeAttribute("disabled"),t&&(t.style.display=""),s&&(s.style.display="none"),console.error("PodLoom: Load more failed",e)})}})}function b(o){if(!(!o||o.length<2||v)){v=!0,c&&(c.textContent="Searching...");var r="undefined"!=typeof podloomPlaylist&&podloomPlaylist.ajaxUrl?podloomPlaylist.ajaxUrl:"/wp-admin/admin-ajax.php",n=new FormData;n.append("action","podloom_search_episodes"),n.append("feed_id",a),n.append("search",o),n.append("order",i),n.append("limit","50"),fetch(r,{method:"POST",body:n}).then(function(e){return e.json()}).then(function(a){v=!1,a.success&&a.data.episodes?function(a,o){var r=d.querySelectorAll(".podloom-episode-item");r.forEach(function(e){e.classList.add("podloom-search-hidden")});var n=0;a.forEach(function(t,a){var o=null;if(r.forEach(function(e){var a=e.querySelector(".podloom-episode-item-title");a&&a.textContent===t.title&&(o=e)}),o)o.classList.remove("podloom-search-hidden"),n++;else{var i=L(t,"search-"+a);i.classList.add("podloom-search-result"),d.appendChild(i),S(i,e,t),n++}}),c&&(c.textContent=n+" episode"+(1!==n?"s":"")+" found");u&&(u.style.display=0===n?"":"none",0===n&&(u.textContent='No episodes found for "'+o+'"'));t(n+" episode"+(1!==n?"s":"")+" found")}(a.data.episodes,o):c&&(c.textContent="")}).catch(function(e){v=!1,console.error("PodLoom: Search failed",e),c&&(c.textContent="")})}}function L(e,t){var a=document.createElement("div");a.className="podloom-episode-item",a.setAttribute("data-episode-index",t),a.setAttribute("data-search-term",(e.title||"").toLowerCase()),a.setAttribute("role","button"),a.setAttribute("tabindex","0"),a.style.cursor="pointer";var o=e.date?new Date(1e3*e.date).toLocaleDateString():"",r=e.duration?A(e.duration):"",n='<div class="podloom-episode-thumb'+(e.image?"":" podloom-episode-thumb-placeholder")+'">';e.image&&(n+='<img src="'+x(e.image)+'" alt="'+x(e.title)+'" loading="lazy" />'),n+='<div class="podloom-episode-play-overlay"><span class="podloom-play-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg></span></div></div>';var i='<div class="podloom-episode-info"><div class="podloom-episode-title-row"><span class="podloom-episode-item-title">'+x(e.title)+'</span></div><div class="podloom-episode-meta-row">'+(o?'<span class="podloom-episode-item-date">'+o+"</span>":"")+(r?'<span class="podloom-episode-item-duration">'+r+"</span>":"")+"</div></div>";return a.innerHTML=n+i,a.podloomEpisodeData=e,a}function A(e){if(!e||isNaN(e))return"";e=parseInt(e,10);var t=Math.floor(e/3600),a=Math.floor(e%3600/60),o=e%60;return t>0?t+":"+(a<10?"0":"")+a+":"+(o<10?"0":"")+o:a+":"+(o<10?"0":"")+o}function x(e){if(!e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}function E(){if(h="",s&&(s.value=""),l&&(l.style.display="none"),c&&(c.textContent=""),d.querySelectorAll(".podloom-search-result").forEach(function(e){e.remove()}),d.querySelectorAll(".podloom-episode-item").forEach(function(e){e.classList.remove("podloom-search-hidden")}),p){var e=p.closest(".podloom-episodes-load-more-wrapper");e&&(e.style.display="")}u&&(u.style.display="none")}function S(e,a,o){function r(){var r=o||e.podloomEpisodeData;if(r&&r.audio_url){var n=a.querySelector(".podloom-playlist-audio");if(n){var i=n.querySelector("source");i?i.src=r.audio_url:n.src=r.audio_url,n.load(),n.play().catch(function(e){console.warn("PodLoom: Could not play",e)}),function(e,t){var a=e.querySelector(".podloom-playlist-title"),o=e.querySelector(".podloom-playlist-date"),r=e.querySelector(".podloom-playlist-duration"),n=e.querySelector(".podloom-playlist-artwork");a&&t.title&&(a.textContent=t.title);o&&t.date&&(o.textContent=new Date(1e3*t.date).toLocaleDateString());r&&t.duration&&(r.textContent=A(t.duration));n&&t.image&&(n.src=t.image,n.alt=t.title||"",n.setAttribute("data-original-src",t.image))}(a,r),a.querySelectorAll(".podloom-episode-item").forEach(function(e){e.classList.remove("podloom-episode-current"),e.removeAttribute("aria-current");var t=e.querySelector(".podloom-episode-play-overlay");t&&(t.innerHTML='<span class="podloom-play-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg></span>')}),e.classList.add("podloom-episode-current"),e.setAttribute("aria-current","true");var s=e.querySelector(".podloom-episode-play-overlay");s&&(s.innerHTML='<span class="podloom-now-playing-icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="4" height="16" rx="1"><animate attributeName="height" values="16;8;16" dur="0.8s" repeatCount="indefinite"/><animate attributeName="y" values="4;8;4" dur="0.8s" repeatCount="indefinite"/></rect><rect x="10" y="4" width="4" height="16" rx="1"><animate attributeName="height" values="8;16;8" dur="0.8s" repeatCount="indefinite"/><animate attributeName="y" values="8;4;8" dur="0.8s" repeatCount="indefinite"/></rect><rect x="16" y="4" width="4" height="16" rx="1"><animate attributeName="height" values="16;8;16" dur="0.8s" repeatCount="indefinite" begin="0.2s"/><animate attributeName="y" values="4;8;4" dur="0.8s" repeatCount="indefinite" begin="0.2s"/></rect></svg></span>'),t("Now playing: "+(r.title||"Episode"))}}}e.addEventListener("click",r),e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),r())})}})}function m(){if("undefined"!=typeof podloomImageCache&&podloomImageCache.ajaxUrl){var e=podloomImageCache.nonce?encodeURIComponent(podloomImageCache.nonce):"";fetch(podloomImageCache.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"action=podloom_process_image_cache&podloom_image_cache_nonce="+e}).then(function(e){return e.json()}).then(function(e){e.success&&e.data.remaining>0&&setTimeout(m,1e3)}).catch(function(){})}}function f(){!function(){function e(e,t,a,o){const r=e.getAttribute("data-tab");t.forEach(function(e){e.classList.remove("active"),e.setAttribute("aria-selected","false"),e.setAttribute("tabindex","-1")}),a.forEach(function(e){e.classList.remove("active"),e.setAttribute("aria-hidden","true")}),e.classList.add("active"),e.setAttribute("aria-selected","true"),e.setAttribute("tabindex","0");const n=o.querySelector("#tab-panel-"+r);n&&(n.classList.add("active"),n.setAttribute("aria-hidden","false"))}document.querySelectorAll(".podcast20-tabs").forEach(function(t){const a=t.querySelectorAll(".podcast20-tab-button"),o=t.querySelectorAll(".podcast20-tab-panel");o.forEach(function(e){e.classList.contains("active")?e.setAttribute("aria-hidden","false"):e.setAttribute("aria-hidden","true")}),a.forEach(function(e,t){e.setAttribute("tabindex",e.classList.contains("active")?"0":"-1")}),a.forEach(function(r,n){r.addEventListener("click",function(){e(r,a,o,t)}),r.addEventListener("keydown",function(r){let i=-1;const s=n;"ArrowRight"===r.key||"ArrowDown"===r.key?(r.preventDefault(),i=(s+1)%a.length):"ArrowLeft"===r.key||"ArrowUp"===r.key?(r.preventDefault(),i=(s-1+a.length)%a.length):"Home"===r.key?(r.preventDefault(),i=0):"End"===r.key&&(r.preventDefault(),i=a.length-1),i>=0&&(a[i].focus(),e(a[i],a,o,t))})})})}(),document.querySelectorAll(".podcast20-chapters-list").forEach(function(e){const o=e.closest(".rss-episode-player");if(!o)return void console.warn("PodLoom: Chapter list found but no episode container");const r=o.querySelector("audio");if(!r)return void console.warn("PodLoom: Chapter list found but no audio player in episode container");const n=o.querySelector(".rss-episode-artwork img");n&&(n.hasAttribute("data-original-src")||n.setAttribute("data-original-src",n.src)),e.querySelectorAll(".chapter-item").forEach(function(o){function n(n){if("A"===n.target.tagName&&n.target.classList.contains("chapter-external-link"))return;if(n.target.closest(".chapter-external-link"))return;n.preventDefault();const i=parseFloat(o.getAttribute("data-start-time"));isNaN(i)||(r.currentTime=i,r.paused&&r.play().catch(function(e){console.warn("PodLoom: Could not auto-play audio:",e)}),a(e,i),t("Playing chapter: "+(o.querySelector(".chapter-title")?.textContent||"")))}o.style.cursor="pointer",o.setAttribute("role","button"),o.setAttribute("tabindex","0"),o.addEventListener("click",n),o.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n(e))})}),r.addEventListener("timeupdate",function(){const t=r.currentTime;a(e,t)})}),document.querySelectorAll(".transcript-format-button").forEach(function(e){e.setAttribute("aria-expanded","false"),e.addEventListener("click",function(){const t=e.closest(".podcast20-transcripts").querySelector(".transcript-viewer"),a=t.querySelector(".transcript-content");if(e.classList.contains("active"))return e.classList.remove("active"),e.setAttribute("aria-expanded","false"),t.style.display="none",void(a.innerHTML="");let r;try{const t=e.getAttribute("data-transcripts");r=JSON.parse(t)}catch(t){r=[{url:e.getAttribute("data-url"),type:e.getAttribute("data-type")||"text/plain"}]}e.classList.add("loading"),e.setAttribute("aria-busy","true"),t.style.display="block",t.setAttribute("aria-busy","true"),a.innerHTML='<div class="transcript-loading" role="status">Loading transcript...</div>',o(r,0,e,a)})}),document.querySelectorAll(".transcript-close").forEach(function(e){e.addEventListener("click",function(){const t=e.closest(".transcript-viewer"),a=e.closest(".podcast20-transcripts").querySelector(".transcript-format-button"),o=t.querySelector(".transcript-content");a.classList.remove("active"),a.setAttribute("aria-expanded","false"),t.style.display="none",o.innerHTML="",a.focus()})}),document.querySelectorAll(".podloom-skip-btn").forEach(function(e){e.hasAttribute("data-initialized")||(e.setAttribute("data-initialized","true"),e.addEventListener("click",function(){var t=parseInt(e.getAttribute("data-skip"),10),a=e.closest(".rss-episode-player");if(a){var o=a.querySelector("audio");if(o){var r=o.currentTime+t;r=Math.max(0,Math.min(r,o.duration||1/0)),o.currentTime=r}}}))}),p(),u(),document.querySelectorAll(".podloom-player-container").forEach(function(e){if(!e.hasAttribute("data-player-initialized")){e.setAttribute("data-player-initialized","true");var t=e.querySelector(".podloom-audio-element");if(t){t.setAttribute("aria-hidden","true"),t.removeAttribute("controls"),t.setAttribute("tabindex","-1"),e.podloomAudio=t;var a=e.querySelector(".podloom-play-toggle"),o=e.querySelector(".podloom-timeline-container"),r=e.querySelector(".podloom-timeline-progress"),n=e.querySelector(".podloom-timeline-slider"),i=e.querySelector(".podloom-current-time"),s=e.querySelector(".podloom-duration"),c=e.querySelector(".podloom-speed-btn"),d=[1,1.25,1.5,2],p=0;a&&a.addEventListener("click",function(){t.paused?t.play().catch(function(e){console.warn("PodLoom: Could not play audio",e)}):t.pause()}),t.addEventListener("play",function(){e.classList.add("is-playing"),a&&a.setAttribute("aria-label",a.getAttribute("data-pause-label")||"Pause")}),t.addEventListener("pause",function(){e.classList.remove("is-playing"),a&&a.setAttribute("aria-label",a.getAttribute("data-play-label")||"Play")}),t.addEventListener("ended",function(){e.classList.remove("is-playing"),a&&a.setAttribute("aria-label",a.getAttribute("data-play-label")||"Play")}),t.addEventListener("timeupdate",function(){var e=t.currentTime,a=t.duration||0;if(i&&(i.textContent=l(e)),a>0&&r){var o=e/a*100;r.style.width=o+"%"}a>0&&n&&(n.value=e)}),t.addEventListener("loadedmetadata",function(){s&&(s.textContent=l(t.duration)),n&&(n.max=t.duration)}),t.addEventListener("durationchange",function(){s&&t.duration&&isFinite(t.duration)&&(s.textContent=l(t.duration)),n&&t.duration&&isFinite(t.duration)&&(n.max=t.duration)}),n&&n.addEventListener("input",function(){var e=parseFloat(n.value);isNaN(e)||(t.currentTime=e)}),o&&o.addEventListener("click",function(e){var a=o.getBoundingClientRect(),r=(e.clientX-a.left)/a.width*(t.duration||0);!isNaN(r)&&isFinite(r)&&(t.currentTime=r)}),c&&c.addEventListener("click",function(){var e=d[p=(p+1)%d.length];t.playbackRate=e,c.textContent=e+"x"})}}}),document.querySelectorAll(".podloom-player-container:not(.podloom-ready), .rss-playlist-player:not(.podloom-ready)").forEach(function(e){e.classList.add("podloom-ready")}),setTimeout(m,500)}if("loading"===document.readyState?document.addEventListener("DOMContentLoaded",f):f(),void 0!==window.MutationObserver){new MutationObserver(function(e){e.forEach(function(e){e.addedNodes.length&&e.addedNodes.forEach(function(e){1===e.nodeType&&(e.classList&&(e.classList.contains("podcast20-tabs")||e.classList.contains("podcast20-chapters-list")||e.classList.contains("rss-playlist-player")||e.classList.contains("podloom-player-container"))||e.querySelector&&(e.querySelector(".podcast20-tabs")||e.querySelector(".podcast20-chapters-list")||e.querySelector(".rss-playlist-player")||e.querySelector(".podloom-player-container")))&&f()})})}).observe(document.body,{childList:!0,subtree:!0})}function h(e){"podloomNodeInserted"===e.animationName&&(e.target.classList.contains("podloom-ready")||f())}document.addEventListener("animationstart",h,!1),document.addEventListener("webkitAnimationStart",h,!1)}();