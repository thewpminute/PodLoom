!function(e){"use strict";const t={init:function(){this.bindEvents()},bindEvents:function(){const e=document.getElementById("podloom_rss_enabled");e&&e.addEventListener("change",e=>{const t=document.getElementById("rss-feeds-container");if(e.target.checked){t.style.display="block";const e=document.getElementById("rss-feeds-list");e&&""===e.innerHTML.trim()&&this.loadFeeds()}else t.style.display="none"});const t=document.getElementById("podloom_rss_minimal_styling");t&&t.addEventListener("change",e=>{const t=document.getElementById("color-palette-section");t&&(t.style.display=e.target.checked?"none":"")});const o=document.getElementById("add-new-rss-feed");o&&o.addEventListener("click",()=>this.showAddFeedModal());const s=document.getElementById("save-rss-settings");s&&s.addEventListener("click",()=>this.saveSettings());const n=document.getElementById("rss-feeds-list");n&&n.addEventListener("click",e=>{const t=e.target.closest("button");if(!t)return;const o=t.dataset.feedId;if(o)if(t.classList.contains("edit-feed")){const e=t.closest("tr").querySelector("td:first-child strong").textContent;this.editFeed(o,e)}else t.classList.contains("refresh-feed")?this.refreshFeed(o,t):t.classList.contains("delete-feed")?this.deleteFeed(o):t.classList.contains("view-feed-xml")&&this.viewFeedXML(o)});const d=document.querySelector(".podloom-palettes-grid");d&&(this.detectCurrentPalette(),d.addEventListener("click",e=>{const t=e.target.closest(".podloom-palette-btn");if(!t)return;const o=t.dataset.bg,s=t.dataset.title,n=t.dataset.text,d=t.dataset.accent,l=document.getElementById("podloom_rss_background_color");l&&(l.value=o,l.dispatchEvent(new Event("input",{bubbles:!0})),l.dispatchEvent(new Event("change",{bubbles:!0})));const a=document.getElementById("rss_background_color");a&&(a.value=o,a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})));const r=(e,t)=>{const o=document.getElementById(e);o&&(o.value=t,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})))};r("title_color",s),r("date_color",n),r("duration_color",n),r("description_color",n);const i=document.getElementById("podloom_rss_accent_color");i&&(i.value=d),this.selectPalette(t)}))},detectCurrentPalette:function(){const e=document.getElementById("podloom_rss_background_color");if(!e)return;const t=e.value.toLowerCase();document.querySelectorAll(".podloom-palette-btn").forEach(e=>{e.dataset.bg.toLowerCase()===t&&this.selectPalette(e)})},selectPalette:function(e){document.querySelectorAll(".podloom-palette-btn").forEach(e=>{e.classList.remove("selected")}),e.classList.add("selected")},editFeed:function(e,t){this.showModal(podloomData.strings.editFeedName,`\n                <label for="rss-feed-name-edit">${podloomData.strings.feedName}</label>\n                <input type="text" id="rss-feed-name-edit" value="${this.escapeHtml(t)}" />\n\n                <div id="rss-modal-error" style="display: none;"></div>\n            `,t=>{const o=document.getElementById("rss-feed-name-edit").value.trim(),s=document.getElementById("rss-modal-error");if(!o)return s.style.display="block",s.className="rss-notice error",void(s.textContent=podloomData.strings.enterFeedName);this.updateFeedName(e,o,t)})},showAddFeedModal:function(){this.showModal(podloomData.strings.addNewFeed,`\n                <label for="rss-feed-name">${podloomData.strings.feedName}</label>\n                <input type="text" id="rss-feed-name" placeholder="${podloomData.strings.feedNamePlaceholder}" />\n\n                <label for="rss-feed-url">${podloomData.strings.feedUrl}</label>\n                <input type="url" id="rss-feed-url" placeholder="${podloomData.strings.feedUrlPlaceholder}" />\n\n                <div id="rss-modal-progress" style="display: none; margin-top: 15px; color: #2271b1;">\n                    <span class="spinner is-active" style="float: none; margin: 0 5px 0 0;"></span>\n                    ${podloomData.strings.addingFeedProgress}\n                </div>\n\n                <div id="rss-modal-error" style="display: none;"></div>\n            `,e=>{const t=document.getElementById("rss-feed-name").value.trim(),o=document.getElementById("rss-feed-url").value.trim(),s=document.getElementById("rss-modal-error");if(!t||!o)return s.style.display="block",s.className="rss-notice error",void(s.textContent=podloomData.strings.fillAllFields);this.addFeed(t,o,e,s)})},addFeed:function(t,o,s,n){const d=s.querySelector(".button-primary"),l=d.textContent,a=document.getElementById("rss-modal-progress");d.textContent=podloomData.strings.adding,d.disabled=!0,a&&(a.style.display="block",n.style.display="none"),e.post(podloomData.ajaxUrl,{action:"podloom_add_rss_feed",nonce:podloomData.nonce,name:t,url:o},e=>{e.success?(this.closeModal(),window.location.reload()):(a&&(a.style.display="none"),n.style.display="block",n.className="rss-notice error",n.textContent=e.data.message||podloomData.strings.errorAddingFeed,d.textContent=l,d.disabled=!1)})},updateFeedName:function(t,o,s){const n=s.querySelector(".button-primary");n.textContent=podloomData.strings.saving,n.disabled=!0,e.post(podloomData.ajaxUrl,{action:"podloom_update_rss_feed_name",nonce:podloomData.nonce,feed_id:t,name:o},e=>{if(e.success)this.closeModal(),window.location.reload();else{const t=s.querySelector("#rss-modal-error");t.style.display="block",t.className="rss-notice error",t.textContent=e.data.message||podloomData.strings.errorUpdatingFeed,n.textContent=podloomData.strings.save,n.disabled=!1}})},refreshFeed:function(t,o){o.innerHTML;o.innerHTML=podloomData.strings.refreshing,o.disabled=!0,e.post(podloomData.ajaxUrl,{action:"podloom_refresh_rss_feed",nonce:podloomData.nonce,feed_id:t},e=>{let t="",o="success";if(e.success)if(e.data.not_modified)t=podloomData.strings.feedUpToDate||"Feed is up to date";else{const o=e.data.episode_count||0;t=(podloomData.strings.feedRefreshed||"Feed refreshed")+" — "+o+" "+(podloomData.strings.episodes||"episodes")}else o="error",t=e.data.cache_kept?(e.data.message||podloomData.strings.errorRefreshingFeed||"Error refreshing feed")+" — "+(podloomData.strings.usingCachedData||"using cached data"):e.data.message||podloomData.strings.errorRefreshingFeed||"Error refreshing feed";this.showNotice(t,o),setTimeout(()=>{window.location.reload()},1500)})},deleteFeed:function(t){confirm(podloomData.strings.deleteFeedConfirm)&&e.post(podloomData.ajaxUrl,{action:"podloom_delete_rss_feed",nonce:podloomData.nonce,feed_id:t},()=>{window.location.reload()})},viewFeedXML:function(t){e.post(podloomData.ajaxUrl,{action:"podloom_get_raw_rss_feed",nonce:podloomData.nonce,feed_id:t},e=>{e.success?this.showXMLModal(e.data.xml):alert(podloomData.strings.errorLoadingFeed+": "+(e.data.message||podloomData.strings.unknownError))})},showXMLModal:function(e){const t=document.getElementById("xml-modal-backdrop"),o=document.getElementById("xml-viewer-modal");t&&document.body.removeChild(t),o&&document.body.removeChild(o);const s=document.createElement("div");s.id="xml-modal-backdrop",s.style.cssText="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); z-index: 100000; display: block;";const n=document.createElement("div");n.id="xml-viewer-modal",n.style.cssText="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; border-radius: 4px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); z-index: 100001; max-width: 900px; width: 90%; max-height: 80vh; display: flex; flex-direction: column;",n.innerHTML=`\n                <div style="padding: 20px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center;">\n                    <h2 style="margin: 0;">${podloomData.strings.rssFeedXml}</h2>\n                    <button type="button" id="xml-modal-close" style="cursor: pointer; font-size: 24px; color: #666; background: none; border: none; padding: 0; line-height: 1;">&times;</button>\n                </div>\n                <div style="padding: 20px; overflow-y: auto; flex-grow: 1;">\n                    <div style="background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 4px; overflow-x: auto; font-family: 'Courier New', Courier, monospace; font-size: 13px; line-height: 1.6; max-height: 60vh; white-space: pre-wrap; word-break: break-all;">${this.escapeHtml(e)}</div>\n                </div>\n            `,document.body.appendChild(s),document.body.appendChild(n);const d=()=>{document.body.contains(s)&&document.body.removeChild(s),document.body.contains(n)&&document.body.removeChild(n)};n.querySelector("#xml-modal-close").addEventListener("click",d),s.addEventListener("click",d)},saveSettings:function(){const t=document.getElementById("save-rss-settings");t.textContent=podloomData.strings.saving,t.disabled=!0;const o={},s=document.getElementById("rss-feeds-settings");s&&s.querySelectorAll('input[name^="podloom_rss_"], select[name^="podloom_rss_"]').forEach(e=>{const t=e.name;"checkbox"===e.type?o[t]=e.checked?"1":"0":o[t]=e.value});["title","date","duration","description"].forEach(e=>{const t=document.getElementById(e+"_font_family");t&&(o["podloom_rss_"+e+"_font_family"]=t.value);const s=document.getElementById(e+"_font_size_value"),n=document.getElementById(e+"_font_size_unit");s&&n&&(o["podloom_rss_"+e+"_font_size"]=s.value+n.value);const d=document.getElementById(e+"_line_height_value");d&&(o["podloom_rss_"+e+"_line_height"]=d.value);const l=document.getElementById(e+"_color");l&&(o["podloom_rss_"+e+"_color"]=l.value);const a=document.getElementById(e+"_font_weight");a&&(o["podloom_rss_"+e+"_font_weight"]=a.value)});const n=document.getElementById("podloom_rss_border_color");n&&(o.podloom_rss_border_color=n.value);const d=document.getElementById("podloom_rss_border_width_value");d&&(o.podloom_rss_border_width=d.value+"px");const l=document.getElementById("podloom_rss_border_style");l&&(o.podloom_rss_border_style=l.value);const a=document.getElementById("podloom_rss_border_radius_value");a&&(o.podloom_rss_border_radius=a.value+"px");const r=document.getElementById("podloom_rss_funding_font_family");r&&(o.podloom_rss_funding_font_family=r.value);const i=document.getElementById("podloom_rss_funding_font_size_value");i&&(o.podloom_rss_funding_font_size=i.value+"px");const c=document.getElementById("podloom_rss_funding_background_color");c&&(o.podloom_rss_funding_background_color=c.value);const m=document.getElementById("podloom_rss_funding_text_color");m&&(o.podloom_rss_funding_text_color=m.value);const u=document.getElementById("podloom_rss_funding_border_radius_value");u&&(o.podloom_rss_funding_border_radius=u.value+"px"),e.post(podloomData.ajaxUrl,{action:"podloom_save_all_rss_settings",nonce:podloomData.nonce,settings:JSON.stringify(o)}).done(e=>{t.textContent=podloomData.strings.saveRssSettings,t.disabled=!1,e.success?this.showNotice(podloomData.strings.settingsSavedSuccess,"success"):this.showNotice(e.data.message||podloomData.strings.errorSavingSettings,"error")}).fail(()=>{t.textContent=podloomData.strings.saveRssSettings,t.disabled=!1,this.showNotice(podloomData.strings.errorSavingSettings,"error")})},showModal:function(e,t,o){const s=document.createElement("div");s.id="rss-modal-backdrop",s.style.display="block";const n=document.createElement("div");n.id="rss-modal",n.style.display="flex",n.innerHTML=`\n                <div id="rss-modal-header">\n                    <h2>${e}</h2>\n                    <button type="button" id="rss-modal-close">&times;</button>\n                </div>\n                <div id="rss-modal-body">\n                    ${t}\n                </div>\n                <div id="rss-modal-footer">\n                    <button type="button" class="button" id="rss-modal-cancel">${podloomData.strings.cancel}</button>\n                    <button type="button" class="button button-primary" id="rss-modal-save">${podloomData.strings.save}</button>\n                </div>\n            `,document.body.appendChild(s),document.body.appendChild(n);const d=()=>{document.body.removeChild(s),document.body.removeChild(n)};n.querySelector("#rss-modal-close").addEventListener("click",d),n.querySelector("#rss-modal-cancel").addEventListener("click",d),n.querySelector("#rss-modal-save").addEventListener("click",()=>o(n)),s.addEventListener("click",d)},closeModal:function(){const e=document.getElementById("rss-modal-backdrop"),t=document.getElementById("rss-modal");e&&document.body.removeChild(e),t&&document.body.removeChild(t)},showNotice:function(e,t){const o=document.getElementById("rss-feeds-settings"),s=document.createElement("div");s.className=`rss-notice ${t}`,s.textContent=e,o.insertBefore(s,o.firstChild),setTimeout(()=>{s.remove()},5e3)},escapeHtml:function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}};window.podloomRssManager=t}(jQuery);